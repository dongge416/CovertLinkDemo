<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<title></title>
		<script src="js/mui.min.js"></script>
		<link href="css/mui.min.css" rel="stylesheet" />
		<script type="text/javascript" charset="utf-8">
			mui.init();
		</script>
	</head>

	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back"></a>
			<h1 class="mui-title">查询页面</h1>
		</header>
		<div id="query_div"  style="display: none;">
			<div class="mui-input-row" style="margin-top: 80px;margin-left: 10px;margin-right: 10px;">
				<textarea id="link_textarea" rows="5" placeholder="输入你要查询的匋宝链接"></textarea>
			</div>
			<div align="center">
				<button id="query_btn" class="mui-btn mui-btn-primary mui-icon mui-icon-search mui-right">
		            查询优惠
		    </button>
				<button type="button" class="mui-btn mui-btn-danger mui-btn-outlined mui-icon mui-icon-trash mui-right">
		            清空文字
		    </button>
			</div>
			<div>
				<button id="test_submit" type="submit" class="mui-btn mui-btn-primary">提交</button>
			</div>
		</div>
		<div id="result_div">
			<header class="mui-bar mui-bar-nav">
			<h1 class="mui-title">优惠信息</h1>
			<button id="btn_back" class="mui-btn mui-btn-blue mui-btn-link mui-btn-nav mui-pull-left">
				<span class="mui-icon mui-icon-left-nav">	
				</span>
				返回
			</button>
			</header>
		</div>
	</body>
	<script>
		mui(document.body).on('tap', '#query_btn', function() {
			var link_textarea = document.getElementById("link_textarea").value;
			console.log(link_textarea);
			var keywords = separateKeywords(link_textarea);
			console.log("keywords:" + keywords);
			analysisKeywords(keywords);

		})
		mui(document.body).on('tap', '#test_submit', function() {
			var content = document.getElementById("link_textarea").value;

			testSubmit(content);
		})
		mui(document.body).on('tap', '#btn_back', function() {
			console.log('点击返回');
		})

		function separateKeywords(content) {
			var result;
			if(content.indexOf("€") != -1) {
				var firstIndex = content.indexOf("€");
				var secondIndex = content.lastIndexOf("€");
				result = content.substring(firstIndex, secondIndex + 1);

				console.log(result);
			} else if(content.indexOf("￥") != -1) {
				var firstIndex = content.indexOf("￥");
				var secondIndex = content.lastIndexOf("￥");
				result = content.substring(firstIndex, secondIndex + 1);
				console.log(result);
			}
			return result;
		}

		function testSubmit(content) {
			mui.ajax('http://localhost/phpworkspace/tbksdk/ConverAction.php', {
				data: {
					content: content
				},
				dataType: 'json', //服务器返回json格式数据
				type: 'get', //HTTP请求类型

				success: function(data) {
					//获得服务器响应
					console.log("获取服务器数据");

					var title = data.data['title'][0];
					mui.alert('优惠信息', title, function() {
						console.log('关闭了警告框');
					}, 'DIV');
				},
				error: function(xhr, type, errorThrown) {
					//异常处理；
					console.log(type);
				}
			});
		}

		function analysisKeywords(keywords) {
			//			TopClient = require('./topClient').TopClient;
			//			var client = new TopClient({
			//				'appkey': '24333767',
			//				'appsecret': '8b5750f690730e4a2938b409329b0a3e',
			//				'REST_URL': 'http://gw.api.taobao.com/router/rest'
			//			});
			//
			//			client.execute('taobao.wireless.share.tpwd.query', {
			//				'password_content': '€emOWbeTTHU0€ ，打开【'
			//			}, function(error, response) {
			//				if(!error) console.log(response);
			//				else console.log(error);
			//			})
		}
	</script>

</html>